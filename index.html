<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>Datacenter Atlas</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.css' rel='stylesheet' />
    <style>
        body {
            margin:0;
            padding:0;
        }

        #map {
            position:absolute;
            top:0;
            bottom:0;
            width:100%;
        }

        .label {
            background-color: blue;
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div id='map'></div>
<script src="data/datacenters.js"></script>
<script>
    L.mapbox.accessToken = 'pk.eyJ1IjoiYXB0LW9wdC1vdXQiLCJhIjoiY2syYmU2a282MWNkdTNtb2JjeHhrdG91dSJ9.bIWJSVgBP7qMeB-IlkqrZw';
    var geocoder = L.mapbox.geocoder('mapbox.places');

    var map = L.mapbox.map('map')
        .addLayer(L.mapbox.styleLayer('mapbox://styles/apt-opt-out/ck2be75ki0nw31cmhmgy812xh'));

    var gj = L.geoJson(null, {
        pointToLayer: function(feature, ll) {
            return L.marker(ll, {
                icon: L.divIcon({
                    className: 'label',
                    html: "!",
                    iconSize: [20, 20]
                })
            });
        }
    }).addTo(map);

    L.mapbox.featureLayer('data/datacenters.geojson').on('ready', function(e) {
        gj.addData(this.getGeoJSON());
    });

    geocoder.query('Netherlands', showMap);

    function showMap(err, data) {
        if (data.lbounds) {
            map.fitBounds(data.lbounds);
        } else if (data.latlng) {
            map.setView([data.latlng[0], data.latlng[1]], 13);
        }
    };

</script>
</body>
</html>